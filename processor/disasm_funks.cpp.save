#include <stdio.h>
#include "processor.h"
#define _USE_MATH_DEFINES
#include <math.h>
#undef NDEBUG
#include <assert.h>


#define DEF_CMD(name, id, args_num, code)                                    \
        case cmd_##name:                                                     \
            {fprintf (disasm, "%s ", #name);                                 \
            for (int arg_id = 0; arg_id < args_num; arg+id++)                \
                {                                                            \
                if (cmd & IMM_MASK)                                          \
                    {                                                        \
                    fprintf (disasm, "%d ", cooking_list[ip + arg_id]);      \
                    }                                                        \
                else if (cmd & REG_MASK)                                     \
                    {                                                        \
                    fprintf (disasm, "(reg#%d) ", cooking_list[ip + arg_id]);\
                    }                                                        \
                else if (cmd & RAM_MASK)                                     \
                    {                                                        \
                    fprintf (disasm, "[%d] ", cooking_list[ip + arg_id]);    \
                    }                                                        \
                }                                                            \
            putc ('\n', disasm);                                             \
                                                                             \
            prc->ip = prc->ip + args_num;\
            break;}


void recogniser (int bin_size, int* cooking_list)
    {
    int ip = 0;

    while (ip < bin_size)
        {
        cmd_enum cmd = (cmd_enum) cooking_list[ip++];
        print_cmd (cmd, cooking_list);
        }
    }


void print_cmd (cmd_enum cmd, int* cooking_list)
    {
    switch (cmd & CMD_MASK)
        {
        #include "cmd.h"
        default:
            printf ("Undefined cmd: %d\n", cmd);
        }
    }

